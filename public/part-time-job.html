<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>登録済みアルバイト情報</title>
    <link rel="stylesheet" href="./css/part-time-job.css">
    <script type="module">
        import { firebaseConfig } from './APIkeys/firebaseAPI.js';
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js';
        import { getFirestore, addDoc, collection, getDocs, query, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js';

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        document.getElementById('jobForm').addEventListener('submit', async function (event) {
            event.preventDefault();
            const jobData = {
                name: document.getElementById('name').value,
                hourlyWage: Number(document.getElementById('hourlyWage').value),
                nightWage: Number(document.getElementById('nightWage').value),
                storeOpenTime: document.getElementById('storeOpenTime').value,
                storeCloseTime: document.getElementById('storeCloseTime').value,
                holidayPay: Number(document.getElementById('holidayPay').value)  // 休日給の値を取得して数値に変換
            };

            try {
                await addDoc(collection(db, "jobs"), jobData);
                alert('登録が完了しました。');
                document.getElementById('jobForm').reset();
                loadJobs();  // データを再読み込み
            } catch (error) {
                console.error('エラーが発生しました: ', error);
                alert('エラーが発生しました。詳細: ' + error.message);
            }
        });

        loadJobs();
        ;

        async function loadJobs() {
            const jobsQuery = query(collection(db, "jobs"));
            const querySnapshot = await getDocs(jobsQuery);
            const jobsList = document.getElementById('jobsList');
            jobsList.innerHTML = '';  // リストをクリア

            const colors = ['#FFCDD2', '#E1BEE7', '#BBDEFB', '#C8E6C9', '#FFECB3', '#F8BBD0', '#D1C4E9', '#C5CAE9', '#DCEDC8', '#FFE082'];  // 色のリスト
            let colorIndex = 0;

            querySnapshot.forEach((doc) => {
                const job = doc.data();
                const listItem = document.createElement('li');
                listItem.innerHTML = `バイト先の名称：${job.name}<br>基本給：${job.hourlyWage}円<br>深夜給：${job.nightWage}円<br>店舗の開店時間：${job.storeOpenTime}<br>店舗の閉店時間：${job.storeCloseTime}<br>休日給：${job.holidayPay}円`;
                listItem.style.marginBottom = "20px";  // 項目間の隙間を設定
                listItem.style.backgroundColor = colors[colorIndex % colors.length];  // 色を設定
                listItem.style.padding = "10px";  // 内側の余白を設定
                listItem.style.borderRadius = "5px";  // 角を丸くする
                colorIndex++;

                const deleteButton = document.createElement('button');
                deleteButton.textContent = '削除';
                deleteButton.style.display = "block";  // ボタンをブロック要素として表示
                deleteButton.style.marginTop = "10px";  // ボタンの上の隙間を設定
                deleteButton.addEventListener('click', () => deleteJob(doc.id));
                listItem.appendChild(deleteButton);
                jobsList.appendChild(listItem);
            });
        }

        async function deleteJob(id) {
            await deleteDoc(doc(db, "jobs", id));
            loadJobs();  // データを再読み込み
        }
    </script>
</head>

<body>
    <header>
        <h1>アルバイト情報登録</h1>
        <nav>
            <ul>
                <li><a href="mainpage.html">ホーム</a></li>
                <li><a href="calendar.html">カレンダー</a></li>
                <li><a href="view-jobs.html">登録済みアルバイト情報</a></li>
                <li><a href="view-schedule.html">登録済み予定</a></li>
            </ul>
        </nav>
    </header>
    <div class="container">
        <form id="jobForm">
            <label for="name">アルバイト先の名称:</label>
            <input type="text" id="name" required><br>
            <label for="hourlyWage">時給:</label>
            <input type="number" id="hourlyWage" required><br>
            <label for="nightWage">深夜給:</label>
            <input type="number" id="nightWage" required><br>
            <label for="storeOpenTime">店舗の開店時間:</label>
            <input type="text" id="storeOpenTime" placeholder="例: 08:00" required><br>
            <label for="storeCloseTime">店舗の閉店時間:</label>
            <input type="text" id="storeCloseTime" placeholder="例: 23:30" required><br>
            <label for="holidayPay">休日給:</label>
            <input type="number" id="holidayPay" required><br>
            <button type="submit">登録</button>
        </form>
        <h2>登録済みのアルバイト情報</h2>
        <u2 id="jobsList"></u2>
        <!-- 前のページに戻るボタン -->
        <a href="mainpage.html" class="back-button">前のページに戻る</a>
    </div>

</body>

</html>